var d=Object.defineProperty;var h=(a,e,t)=>e in a?d(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>h(a,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const l={url:"https://script.google.com/macros/s/AKfycbxVWlAlL95CIkBJrqcjrzmFeke7FBav_0RH7UN_3t0bWa5Z0LRYOnngxNbHI9jKR_INfw/exec",sheets:{tech:"Техно",marketing:"Маркетинг",office:"Офис",base:"База",corps:"Корпики",school:"Школа капитанов"},validValuesSource:{common:{paymentSource:"A",globalTarget:"B",direction:"C"},marketing:{purpose:"E",name:"F"},tech:{purpose:"K",name:"L"},office:{purpose:"G",name:"H"},base:{purpose:"I",name:"J"},corps:{purpose:"M",name:"N"},school:{purpose:"O",name:"P"}}};function i(a,e){const t=document.createElement(a);return e&&(t.className=e),t}class u{constructor(){c(this,"el");c(this,"fields");c(this,"selectElements");this.el=document.createElement("form"),this.el.className="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",this.el.action=l.url,this.el.method="post",this.selectElements={};const e=i("div","flex items-center justify-between"),t=i("button","bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline");t.type="submit",t.innerText="Отправить",e.append(t),this.fields={fieldSelectDepartment:this.createDropdown("departmentName","Отдел"),fieldDate:this.createInput("date","date","Дата"),fieldDescription:this.createInput("description","text","Описание"),fieldSeller:this.createInput("seller","text","Контрагент"),fieldPrice:this.createInput("price","number","Сумма"),fieldSelectPaymentMethod:this.createDropdown("paymentMethod","Фин. поток"),fieldSelectDirection:this.createDropdown("direction","Направление"),fieldSelectGlobalPurpose:this.createDropdown("department","Глобальная статья"),fieldSelectPurpose:this.createDropdown("purpose","Статья расхода"),fieldSelectName:this.createDropdown("name","Кто внёс"),fieldButton:e},this.selectElements.departmentName.append(this.createOption("Выберите отдел...",""),this.createOption("Техно","tech"),this.createOption("Маркетинг","marketing"),this.createOption("Офис","office"),this.createOption("База","base"),this.createOption("Корпики","corps"),this.createOption("Школа капитанов","school")),this.el.append(this.fields.fieldSelectDepartment),this.el.addEventListener("submit",this.sendForm.bind(this))}showFields(){this.el.append(...Object.values(this.fields))}addOptions(e){const t=this.selectElements.departmentName.value;this.selectElements.paymentMethod.innerHTML="",this.selectElements.department.innerHTML="",this.selectElements.purpose.innerHTML="",this.selectElements.name.innerHTML="",e.common.paymentSource.forEach(n=>{this.selectElements.paymentMethod.append(this.createOption(n))}),e.common.globalTarget.forEach(n=>{this.selectElements.department.append(this.createOption(n))}),e.common.direction.forEach(n=>{this.selectElements.direction.append(this.createOption(n))}),e[t].purpose.forEach(n=>{this.selectElements.purpose.append(this.createOption(n))}),e[t].name.forEach(n=>{this.selectElements.name.append(this.createOption(n))})}async sendForm(e){e.preventDefault();const t=new FormData(this.el),n=this.selectElements.departmentName.value;t.append("sheet",l.sheets[n]);try{(await fetch(l.url,{method:"POST",body:t})).status===200&&this.afterSend(!0)}catch{this.afterSend(!1)}}createInput(e,t="text",n){const s=i("div","mb-4"),o=i("label","block text-gray-700 text-sm font-bold mb-2");o.htmlFor=e,o.innerText=n;const r=i("input","shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline");return r.name=e,r.id=e,r.type=t,r.required=!0,s.append(o,r),s}createDropdown(e,t){const n=i("div","mb-4"),s=i("label","block text-gray-700 text-sm font-bold mb-2");s.htmlFor=e,s.innerText=t;const o=i("div","relative"),r=i("select","block relative appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-2 px-3 rounded leading-tight focus:outline-none focus:bg-white focus:shadow-outline");r.name=e,r.id=e;const p=i("div","pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700");return p.innerHTML='<svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>',o.append(r,p),n.append(s,o),this.selectElements[e]=r,n}createOption(e,t=e){const n=document.createElement("option");return n.textContent=e,n.value=t,n}afterSend(e){const t=document.querySelector("#app"),n=i("div");n.className="flex flex-col items-center bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4";const s=i("img","block mb-4"),o=i("h3","mb-4"),r=i("button");r.className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",r.textContent="Я потратил ещё",r.addEventListener("click",()=>{window.location.href="./"}),e?(s.src="icon-success.svg",o.textContent="Успешно внесено"):(s.src="icon-error.svg",o.textContent=`Что-то пошло не так...
Проверь таблицу!`),n.append(s,o,r),t&&t.replaceChildren(n)}}class m{constructor(){c(this,"appContainer");c(this,"form");c(this,"inputValidValues");this.appContainer=document.querySelector("#app-container"),this.form=new u}async init(){const e=i("h2","text-center text-4xl font-extrabold mb-4");e.textContent=">>>",this.appContainer.prepend(e),this.inputValidValues=await this.getValidValues(),e.remove(),this.appContainer.prepend(this.form.el),this.form.selectElements.departmentName.addEventListener("change",this.selectDepartmentHandler.bind(this))}selectDepartmentHandler(){this.inputValidValues&&(this.form.addOptions(this.inputValidValues),this.form.showFields())}async getValidValues(){const e=l.validValuesSource;return await(await fetch(l.url+`?request=${JSON.stringify(e)}`)).json()}}const f=new m;f.init();
